# We use Makefile for simplifying mvn command's usage.
# Since autotest-ca is a Java-based component, its binary build and release should be done through mvn, without relying on Makefile.

BASH:=$(shell which bash)
PROJ_DIR:=$(shell pwd)

## This is a Makefile for "autotest-ca" project.
## - https://github.com/moneyforward/autotest-ca/wiki/9-ContributionGuidelines%7CMakefile
ABOUT:
	@echo "About this Makefile"

## Does a pre-check if your environment is properly set up.
precheck:
	@echo "Currently not yet implemented."

## Cleans all intermediate files, which should be generated only under `target` directory.
clean: clean-doc
	mvn clean

## Compiles production source code only
compile:
	mvn clean compile
## Executes unit tests
test:
	mvn clean compile test
## Generates wiki-site on your local.
## Generated site is found under .work/doc/wiki
## Please upgrade your local bash version by using `brew install bash`.
doc:
	$(BASH) -eu $(PROJ_DIR)/src/build_tools/generate-wiki.sh compile -- "*.md:src/site/markdown:"

## Publishes generated site to the repo's wiki.
## Use with caution.
publish-doc: clean-doc doc _publish-doc
	:

# Deploys wiki-site
_publish-doc:
	$(BASH) -eu $(PROJ_DIR)/src/build_tools/generate-wiki.sh deploy

## Cleans intermediate files generated by the `generate-wiki.sh` tool.
clean-doc:
	$(BASH) -eu $(PROJ_DIR)/src/build_tools/generate-wiki.sh clean

